---
import { getEntry } from 'astro:content';
import Layout      from '@/layouts/Layout.astro';
import { getApiSidebar } from '@/lib/getApiSidebar';
import Sidebar from '@/components/Sidebar.astro';

export async function getStaticPaths() {
  const { grouped } = await getApiSidebar();
  return Object.values(grouped).flat().map(d => ({
    params: { slug: d.slug }
  }));
}

const { slug } = Astro.params;
const entryResult = await getEntry('api', slug);
if (!entryResult) throw new Error(`Entry not found for slug: ${slug}`);
const { Content } = await entryResult.render();
const { data } = entryResult;

const { categories, grouped } = await getApiSidebar();
---

<Layout
  title={data.title}
  heroImage="https://github.com/pokepetter/ld44_life_is_currency/blob/master/value_of_life_screenshot.jpg?raw=true"
  heroHeading={data.title}
  heroDesc={data.description}
  heroSource={data.source}
>
  <section class="py-16 bg-background/95 dark:bg-background">
    <div class="container mx-auto px-6 flex gap-8">
      <Sidebar {categories} {grouped} client:load />

      <main class="flex-1 prose prose-lg max-w-none bg-card p-6 rounded-lg shadow dark:prose-invert">
        <Content />
      </main>
    </div>
  </section>
</Layout>
