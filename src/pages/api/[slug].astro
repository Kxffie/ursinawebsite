---
import { getEntry } from 'astro:content';
import Layout from '@/layouts/Layout.astro';
import { getSidebarData } from '@/lib/getSidebarData';
import Sidebar from '@/components/Sidebar.astro';

export async function getStaticPaths() {
  const base = 'api';
  const { grouped } = await getSidebarData(base);
  const allEntries = Object.values(grouped).flat();

  return allEntries.map((entry) => ({
    params: { slug: entry.slug },
  }));
}

const base = 'api';

let slug = Astro.params.slug;
if (Array.isArray(slug)) {
  slug = slug[0];
}

const entry = await getEntry(base, slug);
if (!entry) {
  throw new Error(`No entry found in "${base}" for slug "${slug}"`);
}

const { data } = entry;
const { Content } = await entry.render();
const { categories, grouped } = await getSidebarData(base);
---

<Layout
  title={data.title}
  heroImage="/heros/value_of_life_screenshot-lossy.jpg"
  heroHeight={40}
  heroHeightMobile={25}
  primaryText={data.title}
  subText={data.description}

  primaryBtn="View on GitHub"
  primaryBtnHref={data.source}
  primaryExternal={true}
>
  <section class="py-16 bg-background/95 dark:bg-background">
    <div class="container mx-auto px-6 flex gap-8">
      <Sidebar {categories} {grouped} base={base} />

      <main class="flex-1 prose prose-lg max-w-none p-6 rounded-lg shadow dark:prose-invert">
        <Content />
      </main>
    </div>
  </section>
</Layout>
